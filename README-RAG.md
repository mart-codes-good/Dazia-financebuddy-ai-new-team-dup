# RAG (Retrieval-Augmented Generation) Setup Guide

## Overview

This guide explains how to use textbooks and educational materials to tailor quiz questions generated by FinanceBuddy.

**How it works:**
1. Drop PDF or text files into `RAG_FILES/` folder
2. Run processing script to index the content
3. Generate quizzes - questions will be tailored to your textbook content!

---

## Quick Start (5 Minutes)

### Step 1: Start ChromaDB (Vector Database)

**Option A: Using Docker (Recommended)**
```bash
docker run -p 8000:8000 chromadb/chroma
```

**Option B: Using Python**
```bash
pip install chromadb
chroma run --path ./chroma_data
```

Leave this running in a separate terminal.

### Step 2: Add Your Files

Drop your textbooks into the `RAG_FILES/` folder:

```bash
# Copy files to RAG_FILES/
cp ~/Downloads/options-trading-textbook.pdf RAG_FILES/
cp ~/Documents/finance-guide.txt RAG_FILES/
```

**Supported formats:**
- PDF (`.pdf`)
- Text (`.txt`)
- Markdown (`.md`)

### Step 3: Process Files

```bash
node process-rag-files.js
```

This will:
- Parse all files in `RAG_FILES/`
- Extract and chunk the text
- Generate embeddings
- Store in ChromaDB

**Output:**
```
ðŸš€ RAG File Processing Script
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“ Found 2 file(s) in ./RAG_FILES/:
   - options-trading-textbook.pdf
   - finance-guide.txt

ðŸ”Œ Connecting to ChromaDB at http://localhost:8000...
âœ… Connected to ChromaDB

ðŸ“š Setting up collection: finance_textbooks...
âœ… Collection ready

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Processing Files
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“„ Processing: options-trading-textbook.pdf
  ðŸ“– Extracting text...
  âœ… Extracted 45230 characters
  ðŸ§¹ Cleaned to 44890 characters
  âœ‚ï¸  Chunking text (size: 800, overlap: 150)...
  âœ… Created 67 chunks
  ðŸ§® Generating embeddings...
  Generating embeddings for chunks 1-10...
  Generating embeddings for chunks 11-20...
  ...
  âœ… Generated 67 embeddings
  ðŸ’¾ Storing in ChromaDB...
  âœ… Successfully stored 67 chunks

ðŸ“„ Processing: finance-guide.txt
  ðŸ“– Extracting text...
  âœ… Extracted 23450 characters
  ...

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Summary
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Successfully processed: 2 file(s)
ðŸ“Š Total chunks created: 98
ðŸ“š Total documents in collection: 98

ðŸŽ‰ Processing complete!
```

### Step 4: Generate Quiz

```bash
node FinanceBuddy.js "Options Trading" 10
```

**Output:**
```
ðŸš€ Generating 10 questions about "Options Trading"...
ðŸ“š Searching for relevant textbook content...
âœ… Found relevant context (3245 characters)
ðŸ“– Using textbook content to tailor questions

ðŸ¤– Generating batch 1/4 (3 questions)...
âœ… Batch 1 completed (3 questions)
...
```

**That's it!** Your quiz questions will now be based on your textbook content! ðŸŽ‰

---

## Detailed Usage

### Processing Files

#### First Time Processing
```bash
node process-rag-files.js
```

This processes all files in `RAG_FILES/` and stores them in ChromaDB.

#### Adding New Files
1. Add new files to `RAG_FILES/`
2. Run `node process-rag-files.js` again
3. Already-processed files will be skipped automatically

#### Re-processing Files
If you want to re-process a file (e.g., after updating it):
1. Delete it from ChromaDB (or delete the collection)
2. Run `node process-rag-files.js` again

### Testing Context Retrieval

Test if your files are being retrieved correctly:

```bash
node retrieve-context.js "options trading"
```

**Output:**
```
ðŸ” Testing context retrieval...
Topic: "options trading"

âœ… ChromaDB is running

ðŸ“Š Collection: finance_textbooks
ðŸ“„ Documents: 98

âœ… Context retrieved successfully!

Context preview:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[Context 1]
Options are financial derivatives that give buyers the right,
but not the obligation, to buy or sell an underlying asset...

[Context 2]
Call options give the holder the right to buy the underlying
asset at a specified strike price...
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Total length: 3245 characters
```

### Generating Quizzes

Generate quizzes as usual - context will be retrieved automatically:

```bash
# With textbook context
node FinanceBuddy.js "Options Trading" 10

# Different topic
node FinanceBuddy.js "Portfolio Management" 5

# Any finance topic
node FinanceBuddy.js "Risk Management" 15
```

**Behavior:**
- âœ… If relevant context found â†’ Questions tailored to your textbook
- âœ… If no context found â†’ Questions generated using general knowledge
- âœ… If ChromaDB not running â†’ Questions generated using general knowledge (with warning)

---

## Configuration

### Environment Variables

Create or edit `.env` file:

```bash
# Gemini API Key (required)
GEMINI_API_KEY=your-api-key-here

# ChromaDB URL (optional, default: http://localhost:8000)
CHROMA_URL=http://localhost:8000

# Chunking settings (optional)
CHUNK_SIZE=800          # Characters per chunk
CHUNK_OVERLAP=150       # Overlap between chunks
```

### Chunking Parameters

Adjust in `process-rag-files.js` or via environment variables:

- **CHUNK_SIZE** (default: 800)
  - Larger = more context per chunk, fewer chunks
  - Smaller = more granular, more chunks
  - Recommended: 600-1000

- **CHUNK_OVERLAP** (default: 150)
  - Prevents splitting concepts across chunks
  - Recommended: 10-20% of chunk size

---

## File Management

### Organizing Files

You can organize files in `RAG_FILES/`:

```
RAG_FILES/
â”œâ”€â”€ options-trading.pdf
â”œâ”€â”€ derivatives-guide.txt
â”œâ”€â”€ portfolio-management.pdf
â””â”€â”€ risk-management.md
```

All files will be processed and stored together in ChromaDB.

### Removing Files

To remove a file's content from the system:

1. **Delete from folder:**
   ```bash
   rm RAG_FILES/old-textbook.pdf
   ```

2. **Clear from ChromaDB:**
   - Option A: Delete and recreate collection (see Troubleshooting)
   - Option B: Files are tagged by filename, so they won't be retrieved

### Updating Files

If you update a textbook:

1. Delete the old version from `RAG_FILES/`
2. Add the new version
3. Clear ChromaDB collection (see Troubleshooting)
4. Run `node process-rag-files.js` again

---

## Troubleshooting

### ChromaDB Not Running

**Error:**
```
âš ï¸  ChromaDB is not running. Start it with: docker run -p 8000:8000 chromadb/chroma
```

**Solution:**
```bash
# Start ChromaDB
docker run -p 8000:8000 chromadb/chroma

# Or with Python
chroma run --path ./chroma_data
```

### No Files Found

**Error:**
```
â„¹ï¸  No files found in ./RAG_FILES/
```

**Solution:**
- Add PDF, TXT, or MD files to `RAG_FILES/` folder
- Check file extensions are correct (`.pdf`, `.txt`, `.md`)

### PDF Parsing Failed

**Error:**
```
âŒ Error: Failed to parse PDF: ...
```

**Solutions:**
- Ensure PDF is not password-protected
- Try converting PDF to text first
- Check if PDF is corrupted

### No Context Retrieved

**Message:**
```
â„¹ï¸  No relevant context found for topic: "Your Topic"
```

**Reasons:**
- Topic doesn't match textbook content
- Files haven't been processed yet
- Similarity threshold too high

**Solutions:**
- Try broader topic terms
- Run `node process-rag-files.js` to process files
- Check files contain relevant content

### Clear ChromaDB Collection

To start fresh:

**Option A: Delete collection (Python)**
```python
import chromadb
client = chromadb.HttpClient(host='localhost', port=8000)
client.delete_collection('finance_textbooks')
```

**Option B: Restart ChromaDB**
```bash
# Stop ChromaDB (Ctrl+C)
# Delete data directory
rm -rf ./chroma_data
# Start again
docker run -p 8000:8000 chromadb/chroma
```

### Check Collection Status

```bash
node retrieve-context.js
```

This shows:
- If ChromaDB is running
- Number of documents in collection
- Collection name

---

## Advanced Usage

### Custom Collection Name

Edit `process-rag-files.js` and `retrieve-context.js`:

```javascript
const COLLECTION_NAME = 'my_custom_collection';
```

### Adjust Context Retrieval

In `retrieve-context.js`, modify:

```javascript
// Get more chunks (default: 5)
const context = await getContext(topic, 10);

// Adjust similarity threshold
const relevantChunks = chunks.filter((chunk, index) => {
  const similarity = 1 - distances[index];
  return similarity > 0.7; // Increase for stricter matching
});
```

### Batch Processing

Process multiple files efficiently:

```bash
# Add all PDFs from a directory
cp ~/textbooks/*.pdf RAG_FILES/

# Process all at once
node process-rag-files.js
```

---

## How It Works

### Architecture

```
1. File Upload
   â””â”€> RAG_FILES/ folder

2. Processing (process-rag-files.js)
   â”œâ”€> Parse PDF/text
   â”œâ”€> Clean text
   â”œâ”€> Chunk into pieces (800 chars)
   â”œâ”€> Generate embeddings (Gemini)
   â””â”€> Store in ChromaDB

3. Quiz Generation (FinanceBuddy.js)
   â”œâ”€> User requests quiz on topic
   â”œâ”€> Search ChromaDB for relevant chunks
   â”œâ”€> Retrieve top 5 most relevant
   â”œâ”€> Include in prompt to Gemini
   â””â”€> Generate tailored questions

4. Result
   â””â”€> Quiz with textbook-specific questions!
```

### Embeddings

- Uses Google Gemini `text-embedding-004` model
- Converts text to 768-dimensional vectors
- Enables semantic search (meaning-based, not keyword-based)

### Chunking Strategy

- **Size:** 800 characters per chunk
- **Overlap:** 150 characters between chunks
- **Boundary:** Breaks at sentence endings when possible
- **Why:** Balances context size with retrieval precision

### Similarity Search

- Uses cosine similarity between embeddings
- Returns top 5 most relevant chunks
- Filters by similarity threshold (>50%)
- Combines chunks with separators

---

## Performance

### Processing Speed

- **PDF parsing:** ~1-2 seconds per page
- **Embedding generation:** ~0.5 seconds per chunk
- **Storage:** ~0.1 seconds per chunk

**Example:** 100-page textbook
- ~200 chunks
- ~2 minutes total processing time

### Retrieval Speed

- **Search:** <100ms
- **Embedding generation:** ~500ms
- **Total:** <1 second

### Storage

- **Embeddings:** ~3KB per chunk
- **Text:** ~800 bytes per chunk
- **Metadata:** ~200 bytes per chunk

**Example:** 100-page textbook
- ~200 chunks
- ~800KB total storage

---

## Best Practices

### File Preparation

1. **Use high-quality PDFs**
   - Text-based PDFs (not scanned images)
   - Clear formatting
   - No password protection

2. **Organize by topic**
   - Keep related materials together
   - Use descriptive filenames

3. **Clean text files**
   - Remove headers/footers
   - Fix formatting issues
   - Use UTF-8 encoding

### Topic Matching

1. **Use specific terms**
   - âœ… "Options Trading Strategies"
   - âŒ "Finance"

2. **Match textbook terminology**
   - Use terms from your textbook
   - Include synonyms if needed

3. **Test retrieval**
   - Use `node retrieve-context.js "topic"` to test
   - Adjust topic terms if needed

### Maintenance

1. **Regular updates**
   - Re-process when textbooks are updated
   - Remove outdated materials

2. **Monitor collection size**
   - Check document count periodically
   - Clear old content if needed

3. **Backup ChromaDB**
   - Copy `./chroma_data` directory
   - Or export collection data

---

## Examples

### Example 1: Options Trading Textbook

```bash
# 1. Add textbook
cp ~/Downloads/options-trading-guide.pdf RAG_FILES/

# 2. Process
node process-rag-files.js

# 3. Generate quiz
node FinanceBuddy.js "Call Options" 10
```

**Result:** Questions about call options based on your specific textbook's explanations and examples.

### Example 2: Multiple Textbooks

```bash
# 1. Add multiple books
cp ~/textbooks/derivatives.pdf RAG_FILES/
cp ~/textbooks/portfolio-management.pdf RAG_FILES/
cp ~/textbooks/risk-analysis.txt RAG_FILES/

# 2. Process all
node process-rag-files.js

# 3. Generate quizzes on different topics
node FinanceBuddy.js "Derivatives Pricing" 10
node FinanceBuddy.js "Portfolio Optimization" 5
node FinanceBuddy.js "Value at Risk" 8
```

**Result:** Each quiz uses relevant content from all textbooks.

### Example 3: Course Materials

```bash
# 1. Add lecture notes and textbook
cp ~/course/lecture-notes.md RAG_FILES/
cp ~/course/textbook-chapter3.pdf RAG_FILES/
cp ~/course/study-guide.txt RAG_FILES/

# 2. Process
node process-rag-files.js

# 3. Generate quiz for exam prep
node FinanceBuddy.js "Chapter 3 Concepts" 15
```

**Result:** Quiz covering material from all course resources.

---

## FAQ

### Q: Do I need to keep ChromaDB running all the time?

**A:** Only when processing files or generating quizzes. You can stop it when not in use.

### Q: Can I use this without ChromaDB?

**A:** No, ChromaDB is required for storing and retrieving embeddings. However, if ChromaDB is not running, FinanceBuddy will still work using general knowledge.

### Q: How much does it cost?

**A:** 
- ChromaDB: Free (open source)
- Gemini API: Free tier includes embeddings
- Only cost is Gemini API usage for quiz generation (same as before)

### Q: Can I use my own vector database?

**A:** Yes, but you'll need to modify `process-rag-files.js` and `retrieve-context.js` to use your database's API.

### Q: What if my textbook is very large?

**A:** No problem! The chunking system handles large documents. A 500-page textbook will create ~1000 chunks, which is fine.

### Q: Can I use scanned PDFs?

**A:** Not directly. You'll need to OCR them first to extract text. Tools like Adobe Acrobat or online OCR services can help.

### Q: How do I know if context is being used?

**A:** FinanceBuddy will print:
```
âœ… Found relevant context (3245 characters)
ðŸ“– Using textbook content to tailor questions
```

### Q: Can I use this for non-finance topics?

**A:** Yes! Just change the prompts in FinanceBuddy.js. The RAG system works for any topic.

---

## Support

### Getting Help

1. **Check this README** - Most questions are answered here
2. **Test components individually:**
   - `node retrieve-context.js "topic"` - Test retrieval
   - `node process-rag-files.js` - Test processing
3. **Check logs** - Error messages usually explain the issue

### Common Issues

| Issue | Solution |
|-------|----------|
| ChromaDB not connecting | Start ChromaDB: `docker run -p 8000:8000 chromadb/chroma` |
| No context found | Check files are processed: `node retrieve-context.js` |
| PDF parsing fails | Ensure PDF is text-based, not scanned |
| Slow processing | Normal for large files; be patient |
| Out of memory | Process files in smaller batches |

---

## Next Steps

1. âœ… **Start ChromaDB**
2. âœ… **Add your first textbook** to `RAG_FILES/`
3. âœ… **Process it:** `node process-rag-files.js`
4. âœ… **Generate a quiz:** `node FinanceBuddy.js "Your Topic" 10`
5. âœ… **Enjoy tailored questions!** ðŸŽ‰

---

**Happy quiz generating!**
